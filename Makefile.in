# Generated by @PACKAGE_NAME@-@PACKAGE_VERSION@
.PHONY: all jar uberjar clean reallyclean run archive

PKGNAME = @PKGNAME@
VERSION = @VERSION@
MVN ?= mvn
RM ?= rm -f
MKDIR ?= mkdir -p
ECHO ?= @echo

all: jar
jar: target/@PKGNAME@.jar
uberjar: target/@PKGNAME@-jar-with-dependencies.jar

target/@PKGNAME@.jar:
	@echo Building @PKGNAME@
	$(MVN) package

target/@PKGNAME@-jar-with-dependencies.jar:
	$(MVN) assembly:single -DdescriptorId=jar-with-dependencies

run: target/@PKGNAME@.jar
	/bin/sh target/bin/webapp

clean:
	$(RM) -r target

reallyclean: clean
	$(RM) config.log config.status pom.xml
	$(ECHO) "You'll have to run ./configure again."

archive:
	$(ECHO) "Generating @PKGNAME@-@VERSION@.tar.gz"
	$(RM) @PKGNAME@-@VERSION@.tar.gz
	$(shell sh -c "git rev-parse HEAD > GIT_SHA1")
	$(ECHO) @VERSION@ > VERSION
	git archive --prefix=@PKGNAME@-@VERSION@/ -o @PKGNAME@-@VERSION@.tar HEAD
	tar --transform 's,^,@PKGNAME@-@VERSION@/,' -rf @PKGNAME@-@VERSION@.tar GIT_SHA1 VERSION
	gzip @PKGNAME@-@VERSION@.tar

